---
title: "TMA4285 Ex3"
author: "Marius Dioli"
date: "September 9, 2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	error = FALSE,
	message = FALSE,
	warning = FALSE,
	include = FALSE,
	results = "hold"
)
knitr::opts_chunk$set(error=TRUE)
knitr::opts_chunk$set(warning=FALSE)
knitr::opts_chunk$set(message=FALSE)
knitr::opts_chunk$set(results="hold")

```


```{r}
#Imports
library("knitr") #probably already installed
library("rmarkdown") #probably already installed
library('astsa')

```

# Minimum

1. Exploring the data with plotting of relevant statistics
2. Transforming the data
3. Model parameter estimation including uncertainty
4. Diagnostics, and model choice discussion


# Plan





# Abstract


# Introduction



# Theory

Outline theory. Start by discussing types of data and behaviour of data. Then talk about modelling and assumptions. Onto MA and AR, then ARMA, then ARIMA processes. Estimation and such

# Data Analysis
```{r}
#Load data
path = "C:/Users/mariu/Documents/Time-Series/mlo_data/"
daily_c13iso = read.csv(paste(path, "daily_flask_c13_mlo.csv", sep=""))
monthly_c13iso = read.csv(paste(path, "monthly_flask_c13_mlo.csv", sep=""))
daily_o18iso = read.csv(paste(path, "daily_flask_o18_mlo.csv", sep=""))
intermittent_c13iso = read.csv(paste(path, "intermittent_flask_c14_mlo.csv", sep=""))
monthly_o18iso = read.csv(paste(path, "monthly_flask_o18_mlo.csv", sep=""))
daily_flask = read.csv(paste(path, "daily_flask_co2_mlo.csv", sep=""))
monthly_flask = read.csv(paste(path, "monthly_flask_co2_mlo.csv", sep=""), na.strings=-99.99)
ten_min_insitu = read.csv(paste(path, "ten_minute_in_situ_co2_mlo.txt", sep=""))
daily_insitu = read.csv(paste(path, "daily_in_situ_co2_mlo.csv", sep=""), comment.char = '%')
weekly_insitu = read.csv(paste(path, "weekly_in_situ_co2_mlo.csv", sep=""))
monthly_insitu = read.csv(paste(path, "monthly_in_situ_co2_mlo.csv", sep=""))

ten_min_insitu
#Prep data
#fixes headers
names(monthly_flask) = c( "Yr", "Mn", "Date1", "Date2", "CO2","seasonally", "fit",  "seasonally2", "CO2_filled", "seasonally3")
monthly_flask

#Splitting into two dataframes so that we can delete the NA rows in the non-filled-in data
monthly_flask1 = monthly_flask
monthly_flask1[9:10] = list(NULL) 

monthly_flask2 = monthly_flask
monthly_flask2[5:8] = list(NULL) 
monthly_flask2
na.omit(monthly_flask1)
```

```{r}
#Creating basic plots
plot(data.frame(monthly_flask2$Date2, monthly_flask2$CO2_filled), type="o", ylab="CO2 Levels")
plot(data.frame(monthly_flask1$Date2, monthly_flask1$CO2), type="o", ylab="CO2 Levels")
plot.ts(monthly_flask2$CO2_filled, type='s')
plot.ts(ts, type='s')



#Averaging the montly reads so that we have one read per month
ts = as.ts(monthly_flask2$CO2_filled, deltat = 1/12)
ts = ts[-1]

acf(ts, length(monthly_flask2$CO2_filled), main='Monthly CO2 flask reading')

#Decomposing using built in r function
decomp_monthly_flask = decompose(ts, 'additive')
plot(as.ts(decomp_monthly_flask$seasonal))
plot(as.ts(decomp_monthly_flask$trend))
plot(as.ts(decomp_monthly_flask$random))
plot(decomp_monthly_flask)
acf(as.ts(decomp_monthly_flask$random[]), length(monthly_flask2$CO2_filled), main='Monthly CO2 flask reading')
stl(ts, "periodic")
#Definitely not stationary, apply differencing and decomposition and compare results. Since the relationship looks linear we apply a linear filter



plot(diff(ts), type='o', main='first difference')
acf(diff(ts), length(monthly_flask2$CO2_filled), main='Monthly CO2 flask reading')

#Nope, we should apply two times differncing

plot(diff(diff(ts)), type='o', main='Second difference')
acf(diff(diff(ts)), length(monthly_flask2$CO2_filled), main='Monthly CO2 flask reading')

#Looking for non-linear relationships (should be done after we have a stationary time series)
lag1.plot(ts, 12)

```

```{r}
#Applying arma and arima model


```




# Discussion
Scoring model using information criteria due to the scarcity of data (maybe). 

Talk about uncertainty, known unknowns, and unknown unknowns.

Weaknesses of chosen model and alternative models.

# Conclusion

# Appendix

# References

